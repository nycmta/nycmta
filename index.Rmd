

---
title: "Project Proposal"
author: "William M. Donovan (wd2328), Hantang Qin (hq2229), Yongyan Liu (yl6107), Yijun Wang (yw4664), Heng Hu (hh2648)"
date: "`r format(Sys.Date())`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

## Tentative Title

*Weather, Storms, and Big Events: Station-Level Impacts on NYC Subway Ridership*

## Motivation

Transit demand in New York City fluctuates with **extreme weather** events (heat waves, heavy rain, and snowstorms) and **large-scale events** (parades, holiday gatherings, and Times Square festivities). This project aims to quantify **station-level** ridership changes associated with weather conditions and permitted events from 2020 to 2025. Our findings will inform service planning, system resilience, and rider communications.

## Initial Questions

1. How do **heat waves** and **storms** affect **station-day** ridership, and which stations are most impacted?
2. Do **large events** create detectable **station-hour** ridership spikes near event venues and routes?
3. Are these effects heterogeneous across **boroughs**, **station types** (transfer hubs vs. local stations), and **weekday/weekend** patterns?

*Note: We will prioritize questions 1–2; time permitting, we will explore clustering of station response patterns.*

## Data Sources

**Ridership (station-level, hourly):**

* *MTA Subway Hourly Ridership: 2020–2024* — dataset ID: `wujg-7c2s`
* *MTA Subway Hourly Ridership: Beginning 2025–* — dataset ID: `5wq4-mkjj`

**Station geocoding:**

* *MTA station complexes with coordinates* (Complex IDs align with hourly ridership)

**Weather (daily):**

* *NOAA GHCN-Daily — Central Park Station* (station ID: USW00094728): daily maximum temperature, precipitation, and snowfall

**Events (date and location):**

* *NYC Permitted Event Information* — historical and current permits (parades, street fairs, etc.)

> **Note:** We will not use the deprecated "MTA Daily Ridership 2020–2025" dataset, as it provides systemwide totals only without station-level detail.

## Planned Analyses and Visualizations

**Data Wrangling**

* Pull hourly ridership data via Socrata API and build **station-day** aggregates (retain **station-hour** granularity for event window analyses).
* Merge GHCN-Daily weather data and create the following indicators:
  * `heatwave`: maximum temperature ≥ 90°F for ≥ 3 consecutive days (with sensitivity checks for alternative thresholds)
  * `storm`: daily precipitation ≥ 1 inch (with alternative thresholds in sensitivity analyses)
* Ingest permitted events data and spatially join to the **nearest station complex** (e.g., within 600–800 meters), flagging `event_day` and hourly event windows.

**Exploratory Data Analysis (EDA)**

* Calendar heatmaps for high-traffic stations, small-multiple time series plots, and borough-faceted visualizations.
* Choropleth maps showing percent change in station-day entries during heat waves, storms, and event days relative to baseline conditions.

**Modeling Approach (Fixed Effects)**

* Within-station fixed effects models controlling for station and date fixed effects:

**Spec A — with date fixed effects (preferred):**

\[
\log\!\big(\text{entries}_{s,d}\big)
= \beta_{1}\,\text{heatwave}_{d}
+ \beta_{2}\,\text{precip}_{d}
+ \beta_{3}\,\text{event}_{s,d}
+ \alpha_{s}
+ \gamma_{d}
+ \varepsilon_{s,d}.
\]

**Spec B — without date fixed effects (lighter; includes DOW/month):**

\[
\log\!\big(\text{entries}_{s,d}\big)
= \beta_{1}\,\text{heatwave}_{d}
+ \beta_{2}\,\text{precip}_{d}
+ \beta_{3}\,\text{event}_{s,d}
+ \delta_{\text{DOW}(d)}
+ \mu_{\text{month}(d)}
+ \alpha_{s}
+ \varepsilon_{s,d}.
\]

* Hourly event-window models for selected venues and transit routes.
* **Sensitivity analyses:** alternative weather thresholds, pandemic period indicators, and exclusion of pandemic-affected periods.

**Stretch Goals (Time Permitting)**

* Cluster stations by response patterns using k-means or hierarchical clustering.
* Develop simple forecasting models (ARIMA or Prophet) for select high-traffic stations.

## Anticipated Coding Challenges

* Managing Socrata API pagination and rate limits for large hourly ridership tables.
* Aligning Complex IDs across ridership and station geometry datasets.
* Defining clean event windows and handling overlapping event permits.
* Accounting for regime changes during the pandemic recovery period (2020–2022).

## Planned Deliverables

* **GitHub Repository (public):** Scripts for data import, cleaning, EDA, and modeling; saved figures; comprehensive README; website source files.
* **Website (GitHub Pages):** Landing page with project overview, results page with interactive visualizations, full written report, and embedded screencast (≤ 2 minutes).
* **Written Report:** Standalone document covering motivation, data sources, exploratory data analysis, statistical methods, results, and limitations.

## Project Timeline

* **By Nov 7, 1:00 PM (Proposal Deadline):** Finalize team composition and project scope (this document); create repository and push initial files.
* **Nov 8–12:** Implement initial data pulls; produce first exploratory plots; define heat wave, storm, and event indicators.
* **Nov 10–14 (Project Review Meeting):** Meet with teaching team; present a cleaned one-week data sample, 2–3 preliminary plots, and a skeleton model.
* **Nov 15–30:** Complete full EDA, fit fixed-effects models, conduct sensitivity analyses, and draft the full report.
* **Dec 1–6 (by 11:59 PM):** Polish report and website; record screencast (≤ 2 minutes); submit final deliverable links.
* **Dec 11:** In-class project discussion.

## Team Member Roles

* **Data Wrangling and API Integration:** TBD
* **Exploratory Data Analysis and Visualization:** TBD
* **Statistical Modeling and Diagnostics:** TBD
* **Website Development and Screencast Production:** TBD
* **Project Management and Quality Assurance (repo hygiene, PR reviews):** TBD

## (Optional) Minimal Feasibility Check

> The following code provides a basic smoke test for data retrieval. Uncomment and adapt as needed before the project review meeting.
>
> **Required packages:** `tidyverse`, `httr`, `jsonlite`, `sf`, `lubridate`

```{r, eval=FALSE, echo=TRUE}

base_url <- "https://data.ny.gov/resource/wujg-7c2s.json"
q <- list(
  "$select" = "complex_id, complex, date, hour_beginning, entries",
  "$where"  = "date between '2024-07-01T00:00:00' and '2024-07-07T23:59:59' AND complex_id in ('R11','R14')",
  "$limit"  = 50000
)
rid_raw <- jsonlite::fromJSON(
  httr::content(httr::GET(base_url, query = q), as = "text", encoding = "UTF-8")
)
rid <- rid_raw %>%
  dplyr::mutate(date = lubridate::as_date(date), entries = as.numeric(entries)) %>%
  dplyr::group_by(complex_id, complex, date) %>%
  dplyr::summarize(entries_day = sum(entries, na.rm = TRUE), .groups = "drop")


```

## References

* MTA Subway Hourly Ridership (2020–2024), dataset ID: `wujg-7c2s`
* MTA Subway Hourly Ridership (Beginning 2025–), dataset ID: `5wq4-mkjj`
* NOAA GHCN-Daily — Central Park Station (USW00094728)
* NYC Permitted Event Information (historical and current)
* MTA Station Complexes (geometry and coordinates)
